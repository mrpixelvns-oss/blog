---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import NewsCard from '../components/NewsCard.astro';

// 1. Fetch d·ªØ li·ªáu t·ª´ WordPress
const response = await fetch(import.meta.env.WORDPRESS_API_URL, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    query: `
      query GetPosts {
        posts(first: 6) {
          nodes {
            title
            slug
            excerpt
            date
            featuredImage {
              node { sourceUrl }
            }
            categories {
              nodes { name }
            }
          }
        }
      }
    `,
  }),
});

const { data } = await response.json();
const posts = data.posts.nodes;
---

<Layout title="Trang Ch·ªß">
    <section class="hero">
        <div class="container">
            <div class="hero-grid">
                {posts.slice(0, 1).map(post => (
                    <div class="featured-article">
                        <a href={`/post/${post.slug}/`}><img src={post.featuredImage?.node.sourceUrl} class="featured-image" /></a>
                        <div class="featured-overlay">
                            <span class="category-badge">{post.categories.nodes[0]?.name}</span>
                            <h2 class="featured-title">{post.title}</h2>
							<div class="article-meta">
								<span>üìÖ 2 gi·ªù tr∆∞·ªõc</span>
								<span>üëÅÔ∏è 15.234 l∆∞·ª£t xem</span>
								<span>‚úçÔ∏è Nguy·ªÖn VƒÉn A</span>
							</div>
                        </div>
                    </div>
                ))}
                
                <div class="sidebar-articles">
                    {posts.slice(1, 4).map(post => (
                        <div class="sidebar-article">
                            <a href={`/post/${post.slug}/`}><img src={post.featuredImage?.node.sourceUrl} class="sidebar-image" /></a>
                            <div class="sidebar-content">
                                <h3>{post.title}</h3>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    </section>

    <section class="latest-section">
        <div class="container">
            <h2 class="section-title">TIN M·ªöI NH·∫§T</h2>
            <div class="latest-grid">
                {posts.map(post => (
                    <NewsCard 
                        title={post.title}
                        excerpt={post.excerpt}
                        image={post.featuredImage?.node.sourceUrl}
                        category={post.categories.nodes[0]?.name}
                        date={new Date(post.date).toLocaleDateString('vi-VN')}
                        slug={post.slug}
                    />
                ))}
            </div>
        </div>
    </section>
</Layout>